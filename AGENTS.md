SAXOバンクOpenAPI仕様
########## OCO注文(TP/SL)の実行確認 ##########
https://www.developer.saxo/openapi/referencedocs/port/v1/closedpositions
\nReference Docs  Portfolio（GETのみ、POSTとDELETEは除外）
ClosedPositions\nRead only end points serving closed positions and the underlying closed positions making up the net closed position. The set of closed positions is restricted by the supplied query parameters as well as whether or not the identity represented by the authorization token has access to the account on which the positions are posted.\n\nA user of a client will have access to accounts under that client\nA user of an IB or WLC will have access to accounts on that client or clients there under\nAn employee has access to all accounts\nA request containing a TradingFloor "Federated Access" token will have access to the account specified in that token.\nIf access is granted on the basis of the TradingFloor "Federated Access" token, then the number of fields will be a subset of the full set of fields shown in the specification for the response.\nEndpoints\nGet closed positions for a client, accountGroup or account\nReturns a list of closed positions fulfilling the criteria specified by the query string parameters.\n\n https://gateway.saxobank.com/sim/openapi/port/v1/closedpositions?$skip={$skip}&$top={$top}&AccountGroupKey={AccountGroupKey}&AccountKey={AccountKey}&ClientKey={ClientKey}&ClosedPositionId={ClosedPositionId}&FieldGroups={FieldGroups}\n\nGet a single position\nGet a single position.\n\n https://gateway.saxobank.com/sim/openapi/port/v1/closedpositions/{ClosedPositionId}?AccountGroupKey={AccountGroupKey}&AccountKey={AccountKey}&ClientKey={ClientKey}&FieldGroups={FieldGroups}\n\nGet closed positions for a client, to which the logged in user belongs\nReturns a list of closed positions fulfilling the criteria specified by the query string parameters.\n\n https://gateway.saxobank.com/sim/openapi/port/v1/closedpositions/me?$skip={$skip}&$top={$top}&FieldGroups={FieldGroups}

https://www.developer.saxo/openapi/referencedocs/cs/v1/historicalreportdata-trades
Reference Docs  Client Services
Historical Report Data - Trades\nTrades Report Data.\n\nEndpoints\nGets all trades for dates or tradeId.\nGets all trades for dates or tradeId.\n\n https://gateway.saxobank.com/sim/openapi/cs/v1/reports/trades/{ClientKey}?$skip={$skip}&$skiptoken={$skiptoken}&$top={$top}&AccountGroupKey={AccountGroupKey}&AccountKey={AccountKey}&FromDate={FromDate}&MockDataId={MockDataId}&ToDate={ToDate}&TradeId={TradeId}

https://www.developer.saxo/openapi/referencedocs/cs/v1/audit-orderactivities
Reference Docs  Client Services
Audit - OrderActivities\nEnd point for querying order activities\n\nEndpoints\nQuery Order activities history\nQuery Order activities history\n\nThe __nextPoll link is present when relevant and MUST be used for continuously polling\n\nOur preferred option for continuously fetching order activities is to stream it out of ENS\n\n https://gateway.saxobank.com/sim/openapi/cs/v1/audit/orderactivities?$skiptoken={$skiptoken}&$top={$top}&AccountKey={AccountKey}&ClientKey={ClientKey}&CorrelationKey={CorrelationKey}&EntryType={EntryType}&FieldGroups={FieldGroups}&FromDateTime={FromDateTime}&IncludeSubAccounts={IncludeSubAccounts}&OrderId={OrderId}&Status={Status}&ToDateTime={ToDateTime}

########## OCO注文(TP/SL)のJSON構造 ##########
https://openapi.help.saxo/hc/en-us/articles/4418479465361-How-do-I-place-related-orders-via-OpenAPI

How do I place related orders via OpenAPI?\nUpdated 3 years ago\nIt is possible to place related orders (for example take profit or stop loss orders) via the endpoint POST /trade/v2/orders/trade/v2/orders. The order object that you post to this endpoint holds a field called Orders. Inside this array you can place order objects for the related orders you wish to place. You can find examples of doing so in the resources below. \n\nRelated Orders are both validated when placed with Saxo, and when the main order has been filled. This is to avoid orders being placed on the wrong side of the market, but there are some scenarios to be familiar with.\n\nWith main orders that have a defined entry price different from the current market price such as a Stop Limit Order, some related orders may not be on the correct side of the market when placed, but will be once they the main order is filled. In this scenario, validation of these related orders uses the entry order price as the assumed market price, so you can properly apply a stop loss and take profit on the assumed entry point, with validation to ensure there no related order on the wrong side of the market.\n\n \n\nMore Resources\n\nLearn page - Order Placement
https://www.developer.saxo/openapi/learn/order-placement

It is possible to place orders on all asset types except for Fx Options, which are not currently tradable via OpenAPI. When placing orders using OpenAPI, it is important to understand that not all order types and parameters are supported for all asset classes or even across one asset type traded on different exchanges. In order to place an order it is usually required to look up some of the underlying instrument's constraints through instrument services in Reference Data and to get a price through a separate request or through a subscription already set up. 
\nOrder Properties\nAssetType & Uic (mandatory)\n\nSpecifies the instrument and how it is traded.\n\nAccountKey (recommended)\n\nUsed to indicate what account the resulting position is on. For clients with sub clients, the order can also be placed on a sub client's account.\n\nAmount (mandatory)\n\nWhen choosing an amount there are certain rules to obey\n\nIf the amount is very small or very large the order may fail\nFor exchange based asset types, if the value of the order is too small, the order will fail\nFor asset types traded in lots, there may be rules around whether odd lot sizes are allowed - this can be looked up by the instrument's LotSizeType\nIn general the amount is always in the base unit of the instrument\nNote that for some instrument types amounts can be fractional. \nOrderType (mandatory)\n\nMost common types are market, limit and stop. See the full overview in the article on Core Business Concepts.\n\nOrderPrice\n\nMust be provided on all order types other than market orders. See section on rounding.\n\nStopLimitPrice\n\nMust be provided for StopLimitOrders. Controls the stop level part of the stoplimit.\n\nToOpenClose\n\nThis value is only relevant and mandatory for StockIndexOption, StockOption and FuturesOption. By setting this value you indicate the desired netting behavior of the resulting position. \n\nManualOrder (mandatory for most applications)\n\nIndicates if the order is originated by a manual or automatic action. While currently optional, this field will soon be made mandatory for almost all applications. Please follow the definition below when deciding how to set this value.\n\nManualOrder Field Value	Meaning\nFalse	\nIndicates an automatic order entry.\n\nAutomated order entry refers to orders that are generated and/or routed without human intervention. This includes any order generated by a computer system as well as orders that are routed using functionality that manages order submission through automated means (i.e. execution algorithm).\n\nTrue	\nIndicates a manual order entry\n\nManual order entry refers to orders that are submitted by an individual directly entering the order into a front-end system, typically via keyboard, mouse or touch screen, and which is routed in its entirety to the match engine at the time of submission. A order that is generated automatically, but ultimately confirmed by the user before being sent to market is considered manual.\n\n\n\nPlacing Single Orders\nNot all instruments support all order types or even all duration types. To find out what order types are supported, look at the instrument data returned by Reference Data. Most instrument support market orders with a duration of the current day. This is demonstrated by this example placing a market order on the EURUSD instrument.\n\nMarket\n\nPOST https://gateway.saxobank.com/sim/openapi/trade/v2/orders\n{\n	"AccountKey": "1ZsMyKSda2eB2GCMrUCKHw==",\n	"Amount": 10000.0,\n	"BuySell": "Buy",\n	"OrderType": "Market",\n	"ManualOrder": true,\n	"Uic": 21,\n	"AssetType": "FxSpot",\n	"OrderDuration": {\n		"DurationType": "DayOrder"\n	}\n}\nMarket orders are executed when the market is open and on whatever price there is in the market at the time of execution. This makes market orders unsuited for instruments with low liquidity. Especially when also having a long duration time.\n\nLimit\n\nIn order to place a limit order we need a target order price at a reasonable distance to the market. A price can be obtained from a price subscription or simply by requesting:\n\nGET https://gateway.saxobank.com/sim/openapi/trade/v1/infoprices?uic=21&AssetType=FxSpot \n{\n	"AccountKey": "1ZsMyKSda2eB2GCMrUCKHw==",\n	"AssetType": "FxSpot",\n	"Quote": {\n		"Ask": 1.06337,\n		"Bid": 1.06317,\n		"DelayedByMinutes": 0\n	},\n	"Uic": 21\n}\nLet's say we want to place a limit order 50 pips away from the market, then the target price would be 1.06287. However for EURUSD valid tick sizes are rounded to nearest 0.00005, so the target order price becomes 1.06285. The order would then be:\n\nPOST https://gateway.saxobank.com/sim/openapi/trade/v2/orders\n{\n	"AccountKey": "1ZsMyKSda2eB2GCMrUCKHw==",\n	"Amount": 10000.0,\n	"BuySell": "Buy",\n	"OrderType": "Limit",\n	"OrderPrice": 1.06285,\n	"ManualOrder": true,\n	"Uic": 21,\n	"AssetType": "FxSpot",\n	"OrderDuration": {\n		"DurationType": "DayOrder"\n	}\n}\nDecimals, TickSize and Tick Size Schemes\nCalculating a correct OrderPrice value is easy for Fx, but complicated for other asset types where there are explicit rules for what values are valid and how they are rounded. Those rules are controlled by the instrument's tick size and tick size scheme. For instruments that does not have a tick size or tick size scheme, order prices simply need to be rounded to the instrument's number of decimals. For the few instruments are quoted in fractions, the order price must conform to the tick size on the instrument.\n\nDecimals\n\nA price is always denoted in the the number of decimals supported by the instrument. The number of decimals can be found on the instrument data looked up in the Reference Data. However for certain Fx crosses the number is one higher if the format has the flag AllowDecimalPips.\n\nWhen there is no tick size scheme\n\nThe order price has to be rounded to the number of decimals of the instrument and then adjusted to the tick size of the instrument. In the above example EURUSD has 4 (+1) decimals and a tick size of 0.00005. This means that a price like 1.062873 should be rounded to 1.06287 due to the number of decimals, but since the tick size is 0.00005, the correct rounding is 1.06285.\n\nWhen there is a tick size scheme\n\nCertain instruments have more complex price rounding rules. That is indicated by the tick size scheme on the instrument. It gives specific tick sizes depending on a price range. If the actual price of the instrument is above the maximum price value in the tick size scheme, the above normal rounding rules apply. The use of tick size schemes are illustrated by this example:\n\n\n\nExample: Suggesting an OrderPrice for a CFD on International Consolidated Airlines Group SA (IAG:xlon)\n\nAssume you want to place a buy limit order for IAG:xlon at 2% away from the market, you need to know the tick size scheme for IAG:xlon as well as the current market price. Right now it is traded at bid 446.1, ask 446.4. \n\nThe tick size scheme for the instrument looked up in reference data is this:\n\nHigh Price\nTick Size\n0.4999	0.0001\n0.9995	0.0005\n4.999	0.001\n9.995	0.005\n49.99	0.01\n99.95	0.05\n499.9	0.1\n999.5	0.5\n4999.0	1.0\n9995.0	5.0\nSince the desired price is in the ]99.99; 499.9] range, we need to round the price to nearest 0.1. Also known as the tick size relevant for the desired order price. In the end the formula for selecting a price n percent away from the market becomes: \n\norderPrice = Round((currentPrice- currentPrice*n/100)/tickSize)*tickSize\nSo filling in the values for a buy order we get\n\ncurrentPrice = 446.4 // currentPrice is the ask side since we are placing an order to buy\nn = 2 \ntickSize = 0.1 \norderPrice = Round((446.4-446.5*2/100)/0.1)*0.1 => orderPrice = 437.5\nSupport for Related Orders\nIt is possible to relate orders to an entry order or position for most asset types. The exceptions are StockIndex (which is not tradable), FutureContracts and FutureStrategies. For the other asset types support for related orders can be deduced from the supported order types retrieved on the instrument. Related orders can be placed together with the entry order or one by one.\n\nThrottling of order placement is per request\nPlacing Multiple Related Orders\nIt is possible to place up to three orders together in a relation. For instance to place an entry order together with a non-working order to guard the resulting position against a drop-off in price.\n\nPOST https://gateway.saxobank.com/sim/openapi/trade/v2/orders\n{\n	"Amount": 10000.0,\n	"BuySell": "Buy",\n	"OrderPrice": 1.06375,\n	"OrderType": "Limit",\n	"Uic": 21,\n	"AssetType": "FxSpot",\n	"ManualOrder": true,\n	"OrderDuration": {\n		"DurationType": "DayOrder"\n	},\n	"Orders": [\n	{\n		"BuySell": "Sell",\n		"OrderPrice": 1.05875,\n		"OrderType": "Stop",\n        "ManualOrder": true,\n		"OrderDuration": {\n			"DurationType": "GoodTillCancel"\n		}\n	}\n	]\n}\nThe service support placing two related orders to an entry order, but the related orders have to be one limit order and one of the various supported stop order types. The result of succesfully placing the above structure is a result containing the resulting two order ids:\n\nHTTP/1.1 200 OK\n{\n	"OrderId": 49036233,\n	"Orders": [\n	{\n		"OrderId": 49036234\n	}\n	]\n}\nAdding a Related Order to an Existing Order\nIt is recommended to place multiple related orders together as one operation. However, if there already is an existing order it too can be done:\n\nPOST https://gateway.saxobank.com/sim/openapi/trade/v2/orders\n{\n	"OrderId": 49036233,\n	"Orders": [\n	{\n		"Uic": 21,\n		"BuySell": "Sell",\n		"Amount": 10000,\n		"ManualOrder": true,\n		"OrderPrice": 1.06575,\n		"AssetType": "FxSpot",\n		"OrderType": "Limit",\n		"OrderDuration": {\n			"DurationType": "GoodTillCancel"\n		}\n	}\n	]\n}\nThe above example adds a second related order to the entry order + stop order from the previous example. It does so, by providing a new order in the related orders collection and referring to the entry order instead of having a full order structure. If it is desired to add two related orders to an entry order it is recommended to do that as one operation, but a second order can be appended later. The request to add the second related order needs to refer to the order id of the entry order as well the first related order. The request that needs to be sent contains the entire structure of a three way order, but where the two first orders are only referred to by id.\n\n{\n	"OrderId": 49036233,\n	"Orders": [\n	{\n		"OrderId": 49026234\n	},\n	{\n		"Uic": 21,\n		"BuySell": "Sell",\n		"Amount": 10000,\n		"OrderPrice": 1.06075,\n		"AssetType": "FxSpot",\n		"OrderType": "Stop",\n		"ManualOrder":true,\n		"OrderDuration": {\n			"DurationType": "GoodTillCancel"\n		}\n	}\n	]\n}\nIt is important to be aware of some pitfalls of doing this:\n\nIt is an error to provide an orderid together with any other parameters. You are either providing a reference to an order or an order placement request\nRelating orders to an already existing order increases the risk that the entry order has been executed when the new related order is entered\nYou can only add two related orders and only one of them can be a limit order\nThe above example does not explicitly use an accountkey to identify the account the order should be on. In this case the client's default account is then used. However, if the entry order had explicitly been placed on another account, the related order should also explicitly be placed on that account. In general it is better to be very explicit about what account a given order is placed on\nWhile amount on the related order can be different between entry and related order, that is not recommended. The related orders are intended to guard the entire resulting position and cannot be used to control netting.\nAdding a Related Order to an Existing Position\nThis only works for clients on End-of-Day netting mode.\nThis is very similar to how an order is added to an existing entry order. The only difference is that instead of providing a reference to the entry order id, a reference to the PositionID must be provided instead. The same concerns as for related orders apply here as well.\n\nPlace an Order to Close a Position\nThere are two ways of closing a position. The most simple one is to open a position for the same amount in the opposite direction and let the netting process remove them. If the client is on End-of-Day-netting it happens overnight - on Intraday-netting the process should be immediate. In some cases you'll want to explicitly control netting by relating an order to the position (again: this can only be done for clients on End-of-Day-netting).\n\nAn order to close is often something you want done now and is no different from placing any other related order. The rules that a position can only have two related orders where a maximum of one is a limit order still apply. So if the goal is to explicitly close a position now, the most simple way is to a) ensure that the position has no related orders and b) relate a market order (or aggressive limit order) to the position. Assuming the position has no related order, the request looks like this:\n\nPOST https://gateway.saxobank.com/sim/openapi/trade/v2/orders \n{\n	"PositionId": 1275430,\n	"Orders": [\n	{\n		"Uic": 21,\n		"BuySell": "Sell",\n		"Amount": 30000,\n		"AssetType": "FxSpot",\n		"OrderType": "Market",\n		"ManualOrder": true,\n		"OrderDuration": {\n			"DurationType": "DayOrder"\n		}\n	}\n	]\n}\nThe catch is that a position can only be related to one other position, so if this method is used to partially close a position, it can never be fully explicitly closed.\n\nPlacing OCO Orders\nOCO orders are a special case where there is no single entry order, but instead is a list of (two) equally valid entry orders.\n\nPOST https://gateway.saxobank.com/sim/openapi/trade/v2/orders\n{\n	"Orders": [\n	{\n		"Uic": 21,\n		"BuySell": "Buy",\n		"Amount": 30000,\n		"OrderPrice": 1.05375,\n		"AssetType": "FxSpot",\n		"OrderType": "Limit",\n 	 	"ManualOrder": true,\n		"OrderDuration": {\n			"DurationType": "GoodTillCancel"\n		}\n	},\n	{\n		"Uic": 21,\n		"BuySell": "Buy",\n		"Amount": 30000,\n		"OrderPrice": 1.06875,\n		"AssetType": "FxSpot",\n		"OrderType": "Stop",\n		"ManualOrder": true,\n		"OrderDuration": {\n			"DurationType": "GoodTillCancel"\n		}\n	}\n	]\n}\nCancelling Orders\nCancelling orders involves calling DELETE with both an OrderId and and AccountKey of the order that is to be deleted\n\nDELETE https://gateway.saxobank.com/sim/openapi/trade/v2/orders/49039256?AccountKey=1ZsMyKSda2eB2GCMrUCKHw==\nIf a delete is issued against an entry order, that can lead to a silent cascading delete on the related orders as well. Multiple orders can be cancelled in one call by providing a comma separated list of OrderIds as long as the orders are on the same account. However, the orders are attempted cancelled one by one and cancellation will stop if an error is encountered.\n\nIt is not guaranteed that an order can always be cancelled. Right before an order is about to be executed it is locked for a short while. While it is in that state cancelling will lead to an error.\nEditing Orders\nEditing orders involves calling PATCH and providing an OrderId in addition to the new values for the fields. For instance changing the target order price of an existing order can look like this.\n\nPATCH https://gateway.saxobank.com/sim/openapi/trade/v2/orders\n{\n    "AccountKey": "zsnh|NO42RmzjC4oPovKGA==",\n	"Amount": 10000.0,\n	"BuySell": "Buy",\n	"OrderType": "Limit",\n	"OrderPrice": 1.06270,\n	"OrderId": 49039256,\n	"Uic": 21,\n	"AssetType": "FxSpot",\n	"OrderDuration": {\n		"DurationType": "DayOrder"\n	}\n}\nIf an order is changed, all fields relevant for that order must be provided. Order editing can be done as a single operation by providing the entire order structure.\n\nHandling Timeouts\nFor orders on exchange based products, order placement will once in a while timeout with a TradeNotCompleted. The status TradeNotCompleted simply means that the request terminated without knowing the status of the resulting order, which is often placed just fine. If an OrderId is also present in the the response, that serves as a reference to the order's status which can then be queried through the Portfolio.\n\nPreventing duplicate orders\nOpenAPI has some level of protection against duplicate orders. For example placing exactly the same order within 15 seconds without specifying a different x-request-id header will be rejected (see Rate Limiting). However, especially when providing an x-request-id header, the calling application should also implement de-bouncing ensure only requesting order placement, when the client actually intends to place an order. Finally, a calling application must wait until a call to OpenAPI returns. Most of the time the call to /trade/v2/orders will return within less than one second. But in the rare cases where the call does not return quickly, because we are awaiting confirmation from an external entity, the calling application should not make a second call to "re-try" placing the same order.\n\nCommon Error Messages\nMessage	Comment\nOrderRelatedPositionMissMatch	Usually happens when a related order is placed on a different account from the position or the position does not exist\nPriceExceedsAggressiveTolerance	Can occur when placing a limit order where the condition for the order is already met by a huge distance\nTooFarFromMarket	Can occur when placing a limit order where the condition for the order is unlikely to be met\nOnWrongSideOfMarket	Occurs when relating an order to a position, and the order's target price is on the wrong side of the current market price\nPriceNotInTickSizeIncrements	Occurs when an order price does not confirm to tick size or formatting rules\n\n\nSee also the live sample for placing orders (with source).

